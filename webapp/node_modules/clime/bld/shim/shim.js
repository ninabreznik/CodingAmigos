"use strict";
var Util = require('util');
var Chalk = require('chalk');
var core_1 = require('../core');
/**
 * A Clime command line interface shim for pure Node.js.
 */
var Shim = (function () {
    function Shim(cli) {
        this.cli = cli;
    }
    /**
     * Execute CLI with an array as `argv`.
     * @param argv - The `argv` array to execute, typically `process.argv`.
     * @param cwd - Current working directory.
     */
    Shim.prototype.execute = function (argv, cwd) {
        this
            .cli
            .execute(argv.slice(2), cwd)
            .then(function (result) {
            if (core_1.isPrintable(result)) {
                result.print(process.stdout, process.stderr);
            }
            else if (result !== undefined) {
                console.log(result);
            }
            process.exit();
        }, function (reason) {
            var exitCode = 1;
            if (core_1.isPrintable(reason)) {
                reason.print(process.stdout, process.stderr);
                if (reason instanceof core_1.ExpectedError) {
                    exitCode = reason.code;
                }
            }
            else if (reason instanceof Error) {
                console.error(Chalk.red(reason.stack));
            }
            else {
                console.error(Chalk.red(Util.format(reason)));
            }
            process.exit(exitCode);
        });
    };
    return Shim;
}());
exports.Shim = Shim;
//# sourceMappingURL=shim.js.map